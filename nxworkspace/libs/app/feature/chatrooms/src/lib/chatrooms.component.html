<ng-container *ngIf='user$ | async as user'>
  <ng-container *ngIf='messages$ | async as messages'>
    <div class='flex flex-col items-center content-center'>
      <h1 mat-dialog-title>Chatrooms</h1>

      <div class='flex flex-row'>
        <div class='flex-auto w-[25%]'>
          <ng-container
            *ngrxLet='selectedMessage?.senderUsername === user.username ? selectedMessage?.recipientUsername : selectedMessage?.senderUsername as recipient'>


            <mat-checkbox [(ngModel)]='unreadFilter'>Filter by Unread</mat-checkbox>
            <mat-selection-list (selectionChange)='change($event)'
                                [multiple]='false'
                                class='flex flex-col items-center content-center'>
              <cdk-virtual-scroll-viewport style='height: 400px; width: 400px'
                                           itemSize='25'

                                           class='flex flex-col items-center content-center'>
                <!--          [ngStyle]='{"background-color": notification.status === 0 ? "#60a1fa" : ""}'-->
                <mat-list-option appMessageDirective [message]='message'
                                 [selectedMessage]='selectedMessage'
                                 [filter]='unreadFilter'
                                 (dblclick)='openConversation(message, recipient)'

                                 *cdkVirtualFor='let message of messages | sortMessages : unreadFilter'
                                 [value]='message'>

            <span
              matListItemTitle>{{message.senderUsername === user.username ? message.recipientUsername : message.senderUsername}}</span>
                  <span matListItemLine>{{message.messageSentTime | date : 'short'}}</span>
                  <p
                    matListItemLine>{{message.senderUsername === user.username ? 'You:' : message.senderUsername + ':'}} {{message.content}}</p>

                  <!--          [color]='notification.status === 0 ? "primary" : "accent"'-->
                </mat-list-option>
              </cdk-virtual-scroll-viewport>
            </mat-selection-list>
          </ng-container>
        </div>
        <div class='flex-auto w-[75%]'>
          <div class='flex flex-col items-center content-center'>
            <h1 mat-dialog-title>{{recipient}}</h1>


            <cdk-virtual-scroll-viewport
              appScrollViewportDirective
              #viewport

              (scrolledIndexChange)='scrollIndex = $event'
              [scrollIndex]='scrollIndex'
              [viewport]='viewport'
              [messages]='messages'
              style='height: 600px; width: 600px; overflow: scroll'
              itemSize='25'
              class='flex flex-col items-center content-center top-0'>
              <!--        column-reverse;-->
              <!--   (scroll)='scrolled($event)'-->
              <!--          [ngStyle]='{"background-color": notification.status === 0 ? "#60a1fa" : ""}'-->
              <div appConversationMessageDirective
                   [username]='user.username'
                   [message]='message'
                   class='flex'
                   *cdkVirtualFor='let message of messages | sortConversationMessages'>
                <div class='flex flex-col mx-3 p-2 rounded-md min-w-[250px] max-w-[250px] hover:bg-gray-200'>
                  <span matListItemTitle>{{message.senderUsername}}</span>
                  <span matListItemLine>{{message.messageSentTime | date : 'short'}}</span>
                  <p style='white-space: pre-line' matListItemLine>{{message.content}}</p>
                </div>

                <!--          class='flex min-w-max bg-gray-100 hover:bg-gray-300'-->
                <!--          [color]='notification.status === 0 ? "primary" : "accent"'-->
              </div>
            </cdk-virtual-scroll-viewport>


            <div class='flex flex-row'>
              <form>
                <mat-form-field>
                  <mat-label>Message</mat-label>
                  <!--            <input [formControl]='messageControl' matInput>-->
                  <textarea matInput [formControl]='messageControl'
                            style='resize: none; white-space: pre-line'></textarea>
                </mat-form-field>
              </form>
              <!--        {{messageControl.value}}-->
              <button
                style='overflow: hidden'
                (click)='sendMessage()'
                mat-button>
                Send
              </button>
            </div>


          </div>
        </div>

      </div>

    </div>
  </ng-container>
</ng-container>