<ng-container *ngIf="user$ | async as user">
  <ng-container *ngrxLet="searchedUser$ | async as userResult">
    <!--  <ng-container *ngIf='appUser$ | async as appUser'></ng-container>-->
    <!--  <ng-container *ngrxLet="defaultImages$ | async as images">-->
    <div class="flex flex-row items-center justify-center">
      <form>
        <!--        <h3>Add User</h3>-->
        <div class="flex flex-row items-center justify-center">
          <h2 mat-dialog-title>Add User</h2>
        </div>
        <div class="mb-4 flex flex-row max-h-[50px]">
          <!--        <label class="block text-gray-700 text-sm font-bold mb-2" for="userName"> UserName </label>-->
          <input
            [formControl]="userNameControl"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            id="userName"
            type="text"
            placeholder="UserName..."
          />
          <button (click)="search()" mat-icon-button>
            <mat-icon>search</mat-icon>
          </button>
        </div>
        <ng-container *ngIf="userResult; else userUndefined">
          <div class="flex items-center space-x-3">
            <!--           <img
                         class="w-8 h-8 rounded-full"
                         matListItemIcon
                         *ngIf="userResult.photoUrl"
                         [src]="userResult.photoUrl | getCdnUrlString"
                         alt=""
                       />-->
            <img
              class="w-8 h-8 rounded-full"
              matListItemIcon
              *ngIf="userResult.photoUrl"
              [src]="userResult.photoUrl"
              alt=""
            />
            <div class="flex flex-col">
              <span *ngIf="userResult.displayName" matListItemTitle
                >{{ userResult.displayName }}
              </span>
              <ng-container *ngIf="userResult.isOnline; then online; else offline"></ng-container>
              <ng-template #online>
                <span
                  *ngIf="userResult.isOnline"
                  class="top-1 left-7 absolute w-3.5 h-3.5 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full"
                ></span>
              </ng-template>
              <ng-template #offline>
                <span
                  class="text-xs"
                  *ngIf="userResult.lastActive && !userResult.isOnline"
                  matListItemLine
                  >Last Active {{ userResult.lastActive | timeDifferenceFromNow }}
                </span>
              </ng-template>
              <ng-container *ngIf="userResult.isFriend">
                <span
                  class="text-xs"
                  *ngIf="userResult.isFriend && userResult.becameFriendsTime"
                  matListItemLine
                  >Friends Since {{ userResult.becameFriendsTime | timeDifferenceFromNow }}
                </span>
              </ng-container>
              <span class="text-xs" *ngIf="userResult.created" matListItemLine
                >User Since {{ userResult.created | timeDifferenceFromNow }}
              </span>
              <span *ngIf="userResult.firstName && userResult.lastName" matListItemLine
                >{{ userResult.firstName }} {{ userResult.lastName }}</span
              >
            </div>
          </div>

          <!--          <ng-container *ngIf="userResult && userResult.isFriend">
                      <div *ngIf="latestSearch && !searching">
                        &lt;!&ndash;            <mat-icon>error</mat-icon>&ndash;&gt;
                        <span>{{ userResult.userName }} is already your friend</span>
                        <button mat-button (click)="viewProfile(userResult.userName)">
                          {{ userResult.userName }} Profile
                        </button>
                      </div>
                    </ng-container>-->
          <!--          <ng-container *ngIf="userResult.toUserStatusEvent === 'SENT_FRIEND_REQUEST_PENDING'">
                      <span>Friend request sent at {{ userResult.toUserStatusDate | date: "short" }}</span>
                      &lt;!&ndash;            <button mat-button (click)="cancelRequest(userResult.userName)">Cancel</button>&ndash;&gt;
                      &lt;!&ndash;            <button mat-button (click)="cancelRequest(userResult.userName)">
                                    Cancel request to {{ userResult.userName }}
                                  </button>&ndash;&gt;
                    </ng-container>-->
          <!--          <ng-container *ngIf="userResult.toUserStatusEvent === 'RECEIVED_FRIEND_REQUEST_PENDING'">
                      <span
                        >Received friend request at {{ userResult.toUserStatusDate | date: "short" }}</span
                      >
                      <button mat-button (click)="acceptFriend(userResult.userName)">
                        Accept {{ userResult.userName }}
                      </button>
                    </ng-container>-->
        </ng-container>
        <!--        <ng-container *ngIf="userResult.userToUserStatus === UserToUserStatus.Pending">
                  <div *ngIf="latestSearch && !searching">
                    &lt;!&ndash;            <mat-icon>error</mat-icon>&ndash;&gt;
                    <span>{{ userResult.userName }} is already your friend</span>
                    <button mat-button (click)="visitProfile(userResult.userName)">
                      {{ userResult.userName }} Profile
                    </button>
                  </div>
                </ng-container>-->
        <ng-template #userUndefined>
          <!--          <mat-spinner *ngIf="searching"></mat-spinner>-->
          <mat-progress-bar *ngIf="searching" mode="indeterminate"></mat-progress-bar>
          <div *ngIf="latestSearch && !searching">
            <mat-icon>error</mat-icon>
            <span>Unable to find {{ latestSearch }}</span>
          </div>
        </ng-template>
        <!--      <ng-container *ngIf="searching">
                <mat-spinner></mat-spinner>
              </ng-container>-->
      </form>
    </div>

    <footer
      class="absolute bottom-0 left-0 flex flex-row items-center justify-center w-full bg-white"
    >
      <div mat-dialog-actions>
        <!--        <button mat-button mat-dialog-close="">Cancel</button>-->
        <ng-container *ngIf="userResult; then active; else disabled"></ng-container>
        <ng-template #active>
          <ng-container *ngIf="userResult">
            <!--            <ng-container *ngIf="userResult.toUserStatusEvent === 'SENT_FRIEND_REQUEST_PENDING'">-->
            <div
              *ngIf="userResult.toUserStatusEvent === 'SENT_FRIEND_REQUEST_PENDING'"
              class="flex flex-col"
            >
              <span class="text-xs"
                >Friend request sent at {{ userResult.toUserStatusDate | date: "short" }}</span
              >
              <button mat-button (click)="cancelRequest(userResult.displayName)">
                Cancel friend request
              </button>
            </div>
            <div
              *ngIf="userResult.toUserStatusEvent === 'RECEIVED_FRIEND_REQUEST_PENDING'"
              class="flex flex-col"
            >
              <span class="text-xs"
                >Received friend request at {{ userResult.toUserStatusDate | date: "short" }}</span
              >
              <button mat-button (click)="acceptFriend(userResult.displayName)">
                Accept friend request
              </button>
            </div>
            <button
              *ngIf="!userResult.toUserStatusEvent && !userResult.isFriend"
              mat-button
              [disabled]="searching || userResult.isFriend"
              (click)="sendFriendRequest(userResult.displayName)"
            >
              Send friend request
            </button>
            <div class="flex flex-col" *ngIf="userResult.isFriend">
              <span class="text-xs">{{ userResult.displayName }} is already your friend</span>
              <button mat-button (click)="viewProfile(userResult.displayName)">View profile</button>
            </div>
            <!--            </ng-container>-->
            <!--       <ng-container [ngSwitch]="userResult.toUserStatusEvent">
                     <ng-container *ngSwitchCase="'SENT_FRIEND_REQUEST_PENDING'">
                       <button mat-button (click)="cancelRequest(userResult.userName)">
                         Cancel friend request
                       </button>
                     </ng-container>
                     <ng-container *ngSwitchCase="'RECEIVED_FRIEND_REQUEST_PENDING'">
                       <button mat-button (click)="acceptFriend(userResult.userName)">
                         Accept friend request
                       </button>
                     </ng-container>
                     &lt;!&ndash;            <span *ngIf="userResult && !userResult.isFriend && !userResult.toUserStatusEvent"
                                 >Add {{ userResult.userName }}</span
                                 >
                               <span *ngIf="userResult && userResult.isFriend">Already Friends</span>&ndash;&gt;
                   </ng-container>-->
          </ng-container>
        </ng-template>
        <ng-template #disabled>
          <button
            [disabled]="!userResult || !latestSearch || searching || userResult.isFriend"
            mat-button
            (click)="sendFriendRequest(userResult?.displayName)"
            cdkFocusInitial
          >
            Select a user
          </button>
        </ng-template>
        <!--        <ng-container *ngIf=""></ng-container>-->
        <!--   <button
             [disabled]="!userResult || !latestSearch || searching || userResult.isFriend"
             mat-button
             (click)="sendFriendRequest(userResult?.userName)"
             cdkFocusInitial
           >
             &lt;!&ndash;        Add {{ userNameControl?.value }}
                     <span></span>&ndash;&gt;
             <ng-container *ngIf="userResult; then active; else disabled"></ng-container>
             <ng-template #active>
               <span *ngIf="userResult && !userResult.isFriend && !userResult.toUserStatusEvent"
                 >Add {{ userResult.userName }}</span
               >
               <span *ngIf="userResult && userResult.isFriend">Already Friends</span>
             </ng-template>
             <ng-template #disabled> Add</ng-template>
           </button>
           <button
             *ngIf="userResult && userResult.toUserStatusEvent === 'SENT_FRIEND_REQUEST_PENDING'"
             mat-button
             (click)="cancelRequest(userResult.userName)"
           >
             Cancel friend request
           </button>
           <button
             *ngIf="userResult && userResult.toUserStatusEvent === 'RECEIVED_FRIEND_REQUEST_PENDING'"
             mat-button
             (click)="acceptFriend(userResult.userName)"
           >
             Accept friend request
           </button>-->
      </div>
    </footer>
  </ng-container>
</ng-container>
