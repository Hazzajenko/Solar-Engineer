version: "3.8"
services:

  # # base images
  # flask_service:
  #   build:
  #     context: ../shared/flask
  #   image: flask_service:python-3.10-slim-bullseye
  #   restart: "no"
  #   deploy:
  #     replicas: 0
  users-api:
    image: users-api:1.0.0
    depends_on:
      - postgres
    expose:
      - "80"
    ports:
      - 5004:80
      - 6004:443
    restart: on-failure
    environment:
    - SERVICE_NAME=1
  # front-proxy
  front-envoy:
    build:
      context: .
      dockerfile: Dockerfile-frontenvoy
    ports:
    - "8080:8080"
    - "8443:8443"
    - "8001:8001"
    # - "${PORT_PROXY:-8080}:8080"
    # - "${PORT_HTTPS:-8443}:8443"
    # - "${PORT_STATS:-8001}:8001"

  # service1:
  #   build:
  #     context: ../shared/tracing
  #   volumes:
  #   - ./service-envoy.yaml:/etc/service-envoy.yaml
  #   environment:
  #   - SERVICE_NAME=1

  # service2:
  #   build:
  #     context: ../shared/tracing
  #   volumes:
  #   - ./service-envoy.yaml:/etc/service-envoy.yaml
  #   environment:
  #   - SERVICE_NAME=2

  postgres:
    image: 'postgres:14.0'
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: SolarEngineer.Root