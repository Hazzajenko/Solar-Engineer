<ng-container *ngIf="project$ | async; let project">
  <ng-container *ngIf="grid$ | async; let grid">
    <ng-container *ngIf="blocks$ | async; let blocks">
      <div cdkDropListGroup class="project-design-container">
        <div *ngFor="let n of numSequence(20); let row = index" class="row">
          <div *ngFor="let n of numSequence(20); let col = index" class="col">
            <ng-container
              *ngrxLet="row | getGridString: col; let locationString"
            >
              <div
                (cdkDropListDropped)="
                  gridDrag.gridDrop($event, project, blocks)
                "
                (click)="
                  gridAction.cellAction(locationString, grid, project, blocks)
                "
                [id]="locationString"
                cdkDropList
                class="drop-zone"
                id="hello"
              >
                <!--                {{ locationString }}-->
                <ng-container
                  *ngIf="blocks | findBlockNumber: locationString; let block"
                >
                  <ng-container
                    *ngrxLet="toJoinArray$ | async; let toJoinArray"
                  >
                    <ng-container [ngSwitch]="block.model">
                      <ng-container *ngSwitchCase="2">
                        <ng-container *ngIf="inverters$ | async; let inverters">
                          <ng-container
                            *ngIf="
                              inverters | findInverterLocation: block.location!;
                              let inverter
                            "
                          >
                            <div
                              (contextmenu)="onRightClick($event, inverter)"
                              *ngIf="inverter.location === locationString"
                              [cdkDragData]="inverter"
                              [matTooltip]="
                                'Location = ' +
                                inverter.location +
                                'Inverter: ' +
                                inverter.name
                              "
                              [style.border]="'2px solid ' + block.color"
                              cdkDrag
                              class="drop-zone__inverter"
                              matTooltipPosition="right"
                            >
                              I

                              <div class="drop-zone__inverter__line">
                                <hr />
                              </div>
                            </div>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngSwitchCase="5">
                        <ng-container *ngIf="panels$ | async; let panels">
                          <ng-container
                            *ngIf="
                              panels | findPanelLocation: block.location!;
                              let panel
                            "
                          >
                            <div
                              (contextmenu)="onRightClick($event, panel)"
                              *ngIf="panel.location === locationString"
                              [cdkDragData]="panel"
                              [matTooltip]="
                                'Location = ' +
                                panel.location +
                                'String: ' +
                                panel.name
                              "
                              [ngStyle]="{
                                'background-color':
                                  grid.selectedString?.id === panel.string_id
                                    ? '#07ffd4'
                                    : '#9ec7f9'
                              }"
                              [style.border]="'2px solid ' + block.color"
                              cdkDrag
                              class="drop-zone__panel"
                              matTooltipPosition="right"
                            >
                              P
                              <!--                            {{ panel.location }}-->
                            </div>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngSwitchCase="6">
                        <ng-container *ngIf="joins$ | async; let joins">
                          <ng-container *ngIf="cables$ | async; let cables">
                            <ng-container
                              *ngIf="
                                cables | findCableLocation: block.location!;
                                let cable
                              "
                            >
                              <ng-container
                                *ngrxLet="
                                  cable | getCableSurroundings: cables:joins;
                                  let surroundingModel
                                "
                              >
                                <div
                                  (contextmenu)="onRightClick($event, cable)"
                                  *ngIf="cable.location === locationString"
                                  [cdkDragData]="cable"
                                  [matTooltip]="'Location = ' + cable.location"
                                  [ngStyle]="{
                                    'background-color': toJoinArray?.includes(
                                      cable.location
                                    )
                                      ? '#07ffd4'
                                      : '#fb7344'
                                  }"
                                  [style.border]="'2px solid ' + cable.color"
                                  cdkDrag
                                  class="drop-zone__cable"
                                  matTooltipPosition="right"
                                >
                                  <div
                                    [ngClass]="{
                                      'drop-zone__cable__draw__top':
                                        surroundingModel.top &&
                                        !surroundingModel.bottom &&
                                        !surroundingModel.left &&
                                        !surroundingModel.right,
                                      'drop-zone__cable__draw__bottom':
                                        !surroundingModel.top &&
                                        surroundingModel.bottom &&
                                        !surroundingModel.left &&
                                        !surroundingModel.right,
                                      'drop-zone__cable__draw__top-bottom':
                                        surroundingModel.top &&
                                        surroundingModel.bottom &&
                                        !surroundingModel.left &&
                                        !surroundingModel.right,
                                      'drop-zone__cable__draw__left-top':
                                        surroundingModel.top &&
                                        !surroundingModel.bottom &&
                                        surroundingModel.left &&
                                        !surroundingModel.right
                                    }"
                                  ></div>
                                  <!--      <div
                                          [ngClass]="{

                                            'drop-zone__cable__draw__bottom':
                                              surroundingModel.bottom
                                          }"
                                        >-->
                                  <!--                              C-->
                                  <!--   <div class="drop-zone__cable__draw">
                                       <hr />
                                     </div>-->
                                  <!--                            {{ cable.location }}-->

                                  <!--                                  </div>-->
                                </div>
                              </ng-container>
                            </ng-container>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>
</ng-container>
<div
  [matMenuTriggerFor]="rightMenu"
  [style.left]="menuTopLeftPosition.x"
  [style.top]="menuTopLeftPosition.y"
  style="visibility: hidden; position: fixed"
></div>

<mat-menu #rightMenu="matMenu" class="custom-menu">
  <ng-template let-item="item" matMenuContent>
    <ng-container [ngSwitch]="item.model">
      <ng-container *ngSwitchCase="2">
        <label>{{ item.name }}</label>
        <ul style="list-style: none">
          <li>Inverter Id: {{ item.id }}</li>
          <li>Location: {{ item["location"] }}</li>
        </ul>
        <button (click)="click()" mat-menu-item>Add</button>
        <button mat-menu-item>Edit</button>
        <button (click)="deleteBlock(item)" mat-menu-item>Delete</button>
      </ng-container>
      <ng-container *ngSwitchCase="5">
        <label>{{ item.name }}</label>
        <ul style="list-style: none">
          <li>Panel Id: {{ item.id }}</li>
          <li>Location: {{ item["location"] }}</li>
          <li>String Id: {{ item["string_id"] }}</li>
        </ul>
        <button (click)="click()" mat-menu-item>Add</button>
        <button mat-menu-item>Edit</button>
        <button (click)="deleteBlock(item)" mat-menu-item>Delete</button>
      </ng-container>
      <ng-container *ngSwitchCase="6">
        <ul style="list-style: none">
          <li>Cable Id: {{ item.id }}</li>
          <li>Size: {{ item["size"] }}</li>
          <li>Location: {{ item["location"] }}</li>
        </ul>
        <button (click)="click()" mat-menu-item>Add</button>
        <ng-container
          *ngrxLet="{
            toJoinArray: toJoinArray$ | async,
            project: project$ | async,
            blocks: blocks$ | async,
            cables: cables$ | async
          } as vm"
        >
          <!--        <ng-container *ngrxLet='toJoinArray$ | async as toJoinArray'>-->
          <ng-container
            *ngIf="vm && vm.toJoinArray && vm.project && vm.blocks && vm.cables"
          >
            <button
              (click)="gridJoins.createJoin(vm)"
              *ngIf="vm.toJoinArray.length > 1"
              mat-menu-item
            >
              Join Cables
            </button>
          </ng-container>
        </ng-container>
        <button mat-menu-item>Edit</button>
        <button (click)="deleteBlock(item)" mat-menu-item>Delete</button>
      </ng-container>
    </ng-container>
  </ng-template>
</mat-menu>
