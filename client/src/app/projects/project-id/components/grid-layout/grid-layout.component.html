<ng-container *ngIf="project$ | async; let project">
  <ng-container *ngIf="modes$ | async; let modes">
    <ng-container *ngrxLet="blocks$ | async as blocks">
      <ng-container *ngrxLet="units$ | async as units">
        <ng-container *ngrxLet="selected$ | async as selected">
          <ng-container *ngrxLet="joins$ | async as joins">
          <div cdkDropListGroup class="project-design-container">
            <div
              *ngFor="let n of numSequence(rows); let row = index"
              class="row"
            >
              <div
                *ngFor="let n of numSequence(cols); let col = index"
                class="col"
              >
                <ng-container
                  *ngrxLet="row | getGridString: col; let locationString"
                >
                  <div
                    (cdkDropListDropped)="
                      gridDrag.gridDrop($event, project, blocks!)
                    "
                    (click)="
                      gridAction.cellAction(
                        locationString,
                        modes,
                        project,
                        blocks!
                      )
                    "
                    [id]="locationString"
                    cdkDropList
                    class="drop-zone"
                  >
                    <ng-container
                      *ngIf="blocks! | blockByLocation: locationString as block"
                    >
                      <app-block-switch
                      [project]="project"
                        [block]="block"
                        [cables]="units?.cables"
                        [disconnectionPoints]="units?.disconnectionPoints"
                        [gridMode]="modes.gridMode"
                        [inverters]="units?.inverters"
                        [panels]="units?.panels"
                        [selected]="selected!"
                        [strings]="units?.strings"
                        [joins]="joins!"
                      ></app-block-switch>
                      <!--                  {# <app-block-switch
                                        [block]="block"
                                        [cables]="units?.cables"
                                        [disconnectionPoints]="(disconnectionPoints$ | async)!"
                                        [gridMode]="modes.gridMode"
                                        [inverters]="(inverters$ | async)!"
                                        [panelJoins]="(panelJoins$ | async)!"
                                        [panels]="(panels$ | async)!"
                                        [selected]="(selected$ | async)!"
                                        [strings]="(strings$ | async)!"
                                      ></app-block-switch> #}-->
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
